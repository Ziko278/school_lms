{% extends 'base/base_admin.html' %}
{% load static %}

{% block title %}Staff Details - {{ staff.user.get_full_name|default:staff.user.username }} | {{ school_info.school_name }}{% endblock %}

{% block main %}
<div class="pagetitle">
    <h1>Staff Details</h1>
    {% include 'components/breadcrumb.html' %}
</div><!-- End Page Title -->

<section class="section profile">
    <div class="row">
        <div class="col-xl-4">

            <div class="card">
                 <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">

                    <h2>{{ staff.user.get_full_name|default:staff.user.username|title }}</h2>
                    <h3>{{ staff.designation|default:"Staff" }}</h3>
                    <p class="small text-muted">{{ staff.department.name|default:"N/A" }}</p>

                    <div class="mt-3">
                         <a href="{% url 'accounts:staff_edit' staff.id %}" class="btn btn-warning btn-sm" title="Edit Staff"><i class="bi bi-pencil-square me-1"></i> Edit</a>
                         <button type="button" class="btn btn-danger btn-sm" title="Delete Staff" data-bs-toggle="modal" data-bs-target="#deleteStaffModal{{ staff.id }}">
                            <i class="bi bi-trash me-1"></i> Delete
                        </button>
                    </div>

                </div>
            </div>

        </div>

        <div class="col-xl-8">

            <div class="card">
                <div class="card-body pt-3">
                    <!-- Bordered Tabs -->
                    <ul class="nav nav-tabs nav-tabs-bordered">

                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-overview">Overview</button>
                        </li>

                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#allocated-courses">Allocated Courses</button>
                        </li>

                        {# <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#performance">Performance</button>
                        </li> #}

                    </ul>
                    <div class="tab-content pt-2">

                        <div class="tab-pane fade show active profile-overview" id="profile-overview">
                            <h5 class="card-title">Staff Details</h5>

                            <div class="row">
                                <div class="col-lg-3 col-md-4 label ">Full Name</div>
                                <div class="col-lg-9 col-md-8">{{ staff.user.get_full_name|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Staff ID</div>
                                <div class="col-lg-9 col-md-8">{{ staff.staff_id|default:"N/A" }}</div>
                            </div>
                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">Department</div>
                                <div class="col-lg-9 col-md-8">{{ staff.department.name|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Designation</div>
                                <div class="col-lg-9 col-md-8">{{ staff.designation|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Date Employed</div>
                                <div class="col-lg-9 col-md-8">{{ staff.date_of_employment|date:"M d, Y"|default:"N/A" }}</div>
                            </div>

                             <h5 class="card-title mt-4">Contact Information</h5>

                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Email</div>
                                <div class="col-lg-9 col-md-8">{{ staff.user.email|default:"N/A" }}</div>
                            </div>
                            <div class="row">
                                <div class="col-lg-3 col-md-4 label">Phone</div>
                                <div class="col-lg-9 col-md-8">{{ staff.user.profile.phone_number|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Address</div>
                                <div class="col-lg-9 col-md-8">{{ staff.user.profile.address|default:"N/A" }}</div>
                            </div>

                             <h5 class="card-title mt-4">Additional Information</h5>

                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Qualifications</div>
                                <div class="col-lg-9 col-md-8">{{ staff.qualifications|linebreaksbr|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Bio</div>
                                <div class="col-lg-9 col-md-8">{{ staff.bio|linebreaksbr|default:"N/A" }}</div>
                            </div>
                             <div class="row">
                                <div class="col-lg-3 col-md-4 label">Account Status</div>
                                <div class="col-lg-9 col-md-8">
                                     {% if staff.user.is_active %}
                                        <span class="badge bg-success">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                    {% endif %}
                                </div>
                            </div>

                        </div>

                        <div class="tab-pane fade pt-3" id="allocated-courses">
                            <h5 class="card-title">Recent Course Allocations</h5>

                            {% if allocated_courses %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr>
                                            <th>Course Code</th>
                                            <th>Course Title</th>
                                            <th>Session</th>
                                            <th>Semester</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for allocation in allocated_courses %}
                                        <tr>
                                            <td>{{ allocation.course.code }}</td>
                                            <td>{{ allocation.course.title|truncatechars:40 }}</td>
                                            <td>{{ allocation.session.name }}</td>
                                            <td>{{ allocation.semester.get_name_display }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="text-end mt-2">
                                <a href="#">View Full Allocation History &raquo;</a> {# Link to full list if available #}
                            </div>
                            {% else %}
                                <p class="text-muted text-center">No course allocations found for this staff member recently.</p>
                            {% endif %}

                        </div>

                         {# <div class="tab-pane fade pt-3" id="performance">
                            <h5 class="card-title">Performance Metrics (Placeholder)</h5>
                             <p>This section can display performance indicators like student feedback scores, result submission timeliness, etc.</p>
                             Add charts or data here
                        </div> #}

                    </div><!-- End Bordered Tabs -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteStaffModal{{ staff.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
        Are you sure you want to delete staff member <strong>{{ staff.user.get_full_name }} ({{ staff.staff_id }})</strong>? This action will also delete their user account and cannot be undone.
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="{% url 'accounts:staff_delete' staff.id %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Delete Staff</button>
        </form>
        </div>
    </div>
    </div>
</div><!-- End Modal -->

{% endblock %}
