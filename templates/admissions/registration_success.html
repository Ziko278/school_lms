{% extends 'base/base_public.html' %}
{% load static %}

{% block title %}Registration Complete | {{ school_info.school_name }}{% endblock %}

{% block main %}
<main>
    <div class="container">

      <section class="section register min-vh-100 d-flex flex-column align-items-center justify-content-center py-4">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8 d-flex flex-column align-items-center justify-content-center">

              <div class="d-flex justify-content-center py-4">
                 <a href="{% url 'website:home' %}" class="logo d-flex align-items-center w-auto">
                   {% if school_info.school_logo %}
                    <img src="{{ school_info.school_logo.url }}" alt="{{ school_info.school_name }} Logo" style="max-height: 40px;">
                   {% endif %}
                  <span class="d-none d-lg-block ms-2">{{ school_info.school_name }}</span>
                </a>
              </div><!-- End Logo -->

              <div class="card mb-3">

                <div class="card-body">

                  <div class="pt-4 pb-2 text-center">
                     <i class="bi bi-check-circle-fill display-1 text-success mb-3"></i>
                    <h5 class="card-title text-center pb-0 fs-4">Registration Completed Successfully!</h5>
                    <p class="text-center small">Welcome, {{ student.user.first_name }}! Your student account has been created.</p>
                  </div>

                   {% include 'components/alerts.html' %}

                   <!-- Account Details -->
                   <div class="mb-4 p-3 border rounded bg-light small">
                       <h6 class="mb-3">Your Account Details</h6>
                       <p class="mb-2">Please keep these details safe. Your login credentials have also been sent to <strong>{{ student.user.email }}</strong>.</p>
                       <div class="row mb-1">
                           <div class="col-5"><strong>Matric No:</strong></div>
                           <div class="col-7 fs-5 fw-bold text-primary">{{ student.matric_number }}</div>
                       </div>
                       <div class="row mb-1">
                           <div class="col-5"><strong>Username:</strong></div>
                           <div class="col-7">{{ username }}</div>
                       </div>
                       <div class="row mb-1 align-items-center">
                           <div class="col-5"><strong>Password:</strong></div>
                           <div class="col-7">
                               <input type="password" id="tempPassword" value="{{ password }}" class="form-control form-control-sm d-inline-block w-auto me-1" readonly style="font-family: monospace;">
                               <button type="button" class="btn btn-outline-secondary btn-sm py-0 px-1" id="togglePasswordVisibility" title="Show/Hide Password">
                                   <i class="bi bi-eye-fill"></i>
                               </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm py-0 px-1" id="copyPassword" title="Copy Password">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                           </div>
                       </div>
                       <div class="mt-3 alert alert-warning small">
                            <strong>Important:</strong> You will be required to change this default password upon your first login.
                       </div>
                   </div>

                    <div class="col-12 mt-4 d-grid gap-2 d-md-flex justify-content-md-center">
                        <a href="{% url 'admissions:admission_letter_download' %}" target="_blank" class="btn btn-secondary"><i class="bi bi-download me-1"></i> Download Admission Letter</a>
                        <a href="{% url 'accounts:login' %}" class="btn btn-primary"><i class="bi bi-box-arrow-in-right me-1"></i> Proceed to Login</a>
                    </div>

                </div>
              </div>

              <div class="credits">
                &copy; {{ school_info.school_name }}
              </div>

            </div>
          </div>
        </div>
      </section>

    </div>
</main><!-- End #main -->
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('tempPassword');
    const toggleButton = document.getElementById('togglePasswordVisibility');
    const copyButton = document.getElementById('copyPassword');

    if (toggleButton && passwordInput) {
        toggleButton.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            // Toggle icon
            this.querySelector('i').classList.toggle('bi-eye-fill');
            this.querySelector('i').classList.toggle('bi-eye-slash-fill');
        });
    }

     if (copyButton && passwordInput) {
        copyButton.addEventListener('click', function() {
            // Temporarily change type to text to allow selection
            const originalType = passwordInput.type;
            passwordInput.type = 'text';
            passwordInput.select();
            try {
                // Use execCommand for broader compatibility within potential iframe restrictions
                document.execCommand('copy');
                // Change icon briefly to show success
                const icon = this.querySelector('i');
                icon.classList.remove('bi-clipboard');
                icon.classList.add('bi-clipboard-check');
                setTimeout(() => {
                    icon.classList.remove('bi-clipboard-check');
                    icon.classList.add('bi-clipboard');
                }, 1500);
            } catch (err) {
                console.error('Failed to copy password: ', err);
                alert('Failed to copy password. Please copy it manually.');
            } finally {
                // Restore original type
                passwordInput.type = originalType;
                 // Deselect text
                window.getSelection().removeAllRanges();
            }
        });
    }

});
</script>
{% endblock %}
